(()=>{var o={830:(e,t,o)=>{var n=o(995),r=o(928),i=o(178),s=0,a=4,c=36,u=Math.pow(c,a);function d(){return r((i()*u<<0).toString(c),a)}function h(){return s=s<u?s:0,++s-1}function l(){return"c"+(new Date).getTime().toString(c)+r(h().toString(c),a)+n()+(d()+d())}l.slug=function(){var e=(new Date).getTime().toString(36),t=h().toString(36).slice(-4),o=n().slice(0,1)+n().slice(-1),r=d().slice(-2);return e.slice(-2)+t+o+r},l.isCuid=function(e){return"string"==typeof e&&!!e.startsWith("c")},l.isSlug=function(e){if("string"!=typeof e)return!1;e=e.length;return 7<=e&&e<=10},l.fingerprint=n,e.exports=l},995:(e,t,o)=>{var r=o(928),o="object"==typeof window?window:self,o=Object.keys(o).length,n=r(((navigator.mimeTypes?navigator.mimeTypes.length:0)+navigator.userAgent.length).toString(36)+o.toString(36),4);e.exports=function(){return n}},178:e=>{var t,o,r="undefined"!=typeof window&&(window.crypto||window.msCrypto)||"undefined"!=typeof self&&self.crypto;o=r?(t=Math.pow(2,32)-1,function(){return Math.abs(r.getRandomValues(new Uint32Array(1))[0]/t)}):Math.random,e.exports=o},928:e=>{e.exports=function(e,t){e="000000000"+e;return e.substr(e.length-t)}}},r={};function A(e){if(r[e])return r[e].exports;var t=r[e]={exports:{}};return o[e](t,t.exports,A),t.exports}A.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return A.d(t,{a:t}),t},A.d=(e,t)=>{for(var o in t)A.o(t,o)&&!A.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},A.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function a(e){this.message=e}(a.prototype=new Error).name="InvalidCharacterError";var r="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,r,n=0,i=0,s="";r=t.charAt(i++);~r&&(o=n%4?64*o+r:r,n++%4)&&(s+=String.fromCharCode(255&o>>(-2*n&6))))r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function n(e){this.message=e}(n.prototype=new Error).name="InvalidTokenError";function e(e,t){if("string"!=typeof e)throw new n("Invalid token specified");var o=!0===(t=t||{}).header?0:1;try{return JSON.parse(function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(r(t).replace(/(.)/g,function(e,t){t=t.charCodeAt(0).toString(16).toUpperCase();return"%"+(t=t.length<2?"0"+t:t)}))}catch(e){return r(t)}}(e.split(".")[o]))}catch(e){throw new n("Invalid token specified: "+e.message)}}var t=A(830),o=A.n(t);const i=/^[a-zA-Z0-9\-_]*#([a-zA-Z0-9\-_]+\/)*[a-zA-Z0-9\-_]+$/;class s{constructor(e,t,o,r,n,i){this.config={...e},this.pageViewId=t,this.subSystem=o,this.actorObserver=r,this.sessionManager=n,this.queue=i,this.queue.bindSendFunction(this.sendEvent.bind(this)),this.eventSequence=0,this.initialized=!0}decorateNewEvent(e){this.eventSequence+=1;var t=`${this.pageViewId}_${this.eventSequence.toString(16).padStart(6,"0")}`,o={...e.actor,...this.actorObserver.getActorOverlay()};const r={...e.target};return(r.courseId||r.resourceId)&&(r.role=this.actorObserver.getRole(r.courseId,r.resourceId)),{...e,failedAttempts:0,achieveSessionId:this.sessionManager.achieveSessionId,subSystemSessionId:this.sessionManager.subSystemSessionId,subSystem:this.subSystem,eventId:t,clientTime:new Date,actor:o,target:r}}push(e){if(!this.initialized)return this.config.logFunc("Discarding event: Arroyo not initialized"),void this.config.logFunc(e);var t="string"==typeof e.action?{id:e.action}:e.action;if(!i.test(t.id))return this.config.logFunc(`Discarding event: Invalid actionId "${t.id}"`),void this.config.logFunc(e);this.queue.push(this.decorateNewEvent({...e,action:t}))}sendEvent(t){var e={av:this.config.version,at:t.failedAttempts+1,eventType:"arroyo",origin:"arroyo",asid:t.achieveSessionId,ssid:t.subSystemSessionId,s:t.subSystem,ct:t.clientTime.toISOString(),eid:t.eventId,actor:this.config.base64EncodeFunc(JSON.stringify(t.actor)),action:this.config.base64EncodeFunc(JSON.stringify(t.action)),target:this.config.base64EncodeFunc(JSON.stringify(t.target))};const o=new URL("/1pixel.png",this.config.baseUrl);return Object.entries(e).filter(e=>!!e[1]).forEach(([e,t])=>{o.searchParams.set(e,t)}),this.config.fetchFunc(o,{method:"GET",mode:"no-cors",headers:{Pragma:"no-cache"}}).then(e=>(this.config.eventSentHook&&this.config.eventSentHook({url:o,response:e}),e.ok||"opaque"===e.type?{wasSuccessful:!0,shouldRetry:!1}:(t.failedAttempts+=1,{wasSuccessful:!1,shouldRetry:t.failedAttempts<this.config.maxRetries}))).catch(e=>(this.config.eventSentHook&&this.config.eventSentHook({url:o,error:e}),{wasSuccessful:!1,shouldRetry:!0,error:e}))}}class c{constructor(e,t){this.document=e,this.domain=t}getCookie(e){if(this.document.cookie){var t=`${e}=`;const o=this.document.cookie.split(";").find(e=>e.trim().startsWith(t));return o?o.trim().substring(t.length):void 0}}setCookie(e,t,o){this.document.cookie=`${e}=${t};path=/;max-age=${o};domain=${this.domain}`}}class u{constructor(e={}){this.courseRoles={},this.resourceRoles={},e.courseAccess&&e.courseAccess.forEach(t=>{Object.keys(t).forEach(e=>{this.courseRoles[e]=t[e]})}),e.resourceAccess&&e.resourceAccess.forEach(t=>{Object.keys(t).forEach(e=>{this.resourceRoles[e]=t[e]})})}getRole(e="",t=""){return t&&this.resourceRoles[t]?this.resourceRoles[t]:e&&this.courseRoles[e]?this.courseRoles[e]:void 0}}class d{constructor(e,t,o){this.actorOverlay={...o};o=e.getCookie("id_token");o&&(o=t(o),this.actorOverlay.userId=o.user_id),this.courseAndResourceRoles={courseRoles:{},resourceRoles:{}},this.courseAndResourceRoles=new u;e=e.getCookie("accessToken");e&&(e=t(e),this.courseAndResourceRoles=new u(e))}getRole(e,t){return this.courseAndResourceRoles.getRole(e,t)}getActorOverlay(){return{...this.actorOverlay}}}class h{constructor(e,t){this.maxBatchSize=10,this.logFunc=e||(()=>{}),this.eventRetryWaitMS=t,this.queue=[]}push(e){return this.scheduleQueueDrain(e).sendPromise}bindSendFunction(e){this.sendFunc=e}retryQueueDrainLater(){this.retryHandle||(this.retryHandle=setTimeout(()=>{let e=1,t={hasMore:!(this.retryHandle=null)};for(;e<this.maxBatchSize&&t.hasMore;)t=this.scheduleQueueDrain(),e+=1},this.eventRetryWaitMS))}scheduleQueueDrain(e){var o=e||this.queue.shift();return{hasMore:0<this.queue.length,sendPromise:o?new Promise(t=>{this.sendFunc(o).then(e=>{e.wasSuccessful||(this.logFunc(`sendEvent failed for eventId ${o.eventId}`),this.logFunc(e.error),e.shouldRetry?(this.queue.push(o),this.retryQueueDrainLater()):(this.logFunc("Dropping event after failure with no further retry"),this.logFunc(o))),t(e)})}):void 0}}}const l=["action","target","actor"];console.log("Arroyo version 0.0.14");var g=o()();window.AYO_NAME=window.AYO_NAME||"ARROYO";var w=window.AYO_FUNC_NAME||"_arroyo",f=window.AYO_SUBSYSTEM||"Unspecified",v=window.AYO_SENT_HOOK||void 0,t=window.AYO_BASE_URL,p=window.AYO_CONFIG||{baseUrl:t,maxRetries:10,logFunc:window.AYO_LOG_FUNC,fetchFunc:(...e)=>fetch(...e),base64EncodeFunc:e=>btoa(e),eventSentHook:v,version:"0.0.14"};try{var S=new c(document,(e=>{if(!e)return e;const t=e.split(".");if(2<t.length){var o=t.pop();return`.${t.pop()}.${o}`}return e})(window.location.hostname)),y=new d(S,e,window.AYO_ACTOR),m=new class{constructor(e,t,o,r){this.cookieProvider=t,this.sessionIdProvider=o,this.sessionTimeoutSeconds=r,this.subSystem=e,this.touchOrCreateSessionCookie("ayo_achieve"),this.touchOrCreateSessionCookie(`ayo_${e}`)}touchOrCreateSessionCookie(e){let t=this.cookieProvider.getCookie(e);return t=t||this.sessionIdProvider(),this.cookieProvider.setCookie(e,t,this.sessionTimeoutSeconds),t}get achieveSessionId(){return this.touchOrCreateSessionCookie("ayo_achieve")}get subSystemSessionId(){return this.touchOrCreateSessionCookie(`ayo_${this.subSystem}`)}}(f,S,o(),1800),S=new h(window.AYO_LOG_FUNC,2e3);window[window.AYO_NAME]=new s(p,g,f,y,m,S),(window.AYO_PRELOAD_QUEUE||[]).forEach(e=>window[window.AYO_NAME].push(e[0])),window[w]=window[window.AYO_NAME].push.bind(window[window.AYO_NAME]),window[`${w}PageLoad`]=()=>{window.AYO_LAST_PAGE_HREF&&window.AYO_LAST_PAGE_HREF===window.location.href?window.AYO_SENT_HOOK&&window.AYO_SENT_HOOK(null):(window.AYO_LAST_PAGE_HREF=window.location.href,window[w]({action:"Arroyo#PageLoad",target:{referrer:document.referrer,url:window.location.href,userAgent:navigator.userAgent,userLanguage:navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage}}))},window[`${w}ParseUrl`]=e=>window.AYO_LOG_FUNC(((e,o)=>{const t=new URL(e),r={origin:t.origin,pathname:t.pathname,params:{}};return t.searchParams.forEach((e,t)=>{r.params[t]=l.includes(t)?JSON.parse(o(e)):e}),r})(e,atob)),window[`${w}PageLoad`]()}catch(e){console.log("Unable to initialize Arroyo"),console.log(e)}})()})();